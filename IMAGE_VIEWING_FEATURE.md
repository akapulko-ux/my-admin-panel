# Функциональность просмотра изображений в чатах фиксаций

## Обзор

Добавлена возможность просмотра фотографий, отправленных пользователями iOS приложения в чатах фиксаций. Функциональность включает:

- Отображение миниатюр изображений в чате
- Полноэкранный просмотр изображений
- Навигацию между изображениями в галерее
- Возможность скачивания и совместного использования изображений
- Удаление изображений (для отправителя)

## Компоненты

### 1. ImageMessageView.js
Компонент для отображения изображений в чате.

**Функции:**
- Отображение миниатюры изображения (150x150px)
- Обработка кликов для открытия полноэкранного просмотра
- Долгое нажатие для показа меню действий
- Индикатор загрузки и обработка ошибок

**Свойства:**
- `message` - объект сообщения с данными изображения
- `isFromCurrentUser` - флаг принадлежности сообщения текущему пользователю
- `onDelete` - функция удаления сообщения
- `onOpenFullScreen` - функция открытия полноэкранного просмотра

### 2. FullScreenImageView.js
Компонент для полноэкранного просмотра изображений.

**Функции:**
- Полноэкранный просмотр изображения
- Навигация между изображениями (стрелки влево/вправо)
- Счетчик изображений (X из Y)
- Кнопки скачивания и совместного использования
- Поддержка клавиатурной навигации (Escape, стрелки)

**Свойства:**
- `isOpen` - флаг открытия модального окна
- `onClose` - функция закрытия
- `images` - массив URL изображений
- `currentIndex` - индекс текущего изображения
- `onIndexChange` - функция изменения индекса

## Структура данных

### Формат mediaURL
Изображения хранятся в формате, совместимом с iOS приложением:
```
"thumbURL||fullURL"
```

Пример:
```
"https://res.cloudinary.com/dwulwgihw/image/upload/c_thumb,w_150,h_150/v1703123456/image.jpg||https://res.cloudinary.com/dwulwgihw/image/upload/v1703123456/image.jpg"
```

### Структура сообщения с изображением
```javascript
{
  id: "message-id",
  text: "Описание изображения",
  senderId: "user-id",
  senderName: "User Name",
  senderRole: "client",
  mediaURL: "thumbURL||fullURL",
  mediaType: "image",
  timestamp: Timestamp,
  isFromCurrentUser: false
}
```

## Интеграция с FixationChat

Компонент `FixationChat` был обновлен для поддержки изображений:

1. **Фильтрация сообщений** - изображения отображаются через `ImageMessageView`
2. **Галерея изображений** - собирает все изображения для полноэкранного просмотра
3. **Обработка удаления** - поддержка удаления сообщений с изображениями

## Переводы

Добавлены переводы для всех текстовых элементов на трех языках:

### Русский
```javascript
fixationChat: {
  imageError: 'Ошибка загрузки изображения',
  imageLoadError: 'Попробуйте еще раз',
  downloadImage: 'Скачать',
  shareImage: 'Поделиться',
  deleteImage: 'Удалить',
  closeImage: 'Закрыть',
  imageShareTitle: 'Изображение из чата',
  imageShareText: 'Посмотрите это изображение',
  messageDeleted: 'Сообщение удалено',
  deleteMessageError: 'Не удалось удалить сообщение'
}
```

### English
```javascript
fixationChat: {
  imageError: 'Image loading error',
  imageLoadError: 'Try again',
  downloadImage: 'Download',
  shareImage: 'Share',
  deleteImage: 'Delete',
  closeImage: 'Close',
  imageShareTitle: 'Image from chat',
  imageShareText: 'Check out this image',
  messageDeleted: 'Message deleted',
  deleteMessageError: 'Failed to delete message'
}
```

### Indonesian
```javascript
fixationChat: {
  imageError: 'Kesalahan memuat gambar',
  imageLoadError: 'Coba lagi',
  downloadImage: 'Unduh',
  shareImage: 'Bagikan',
  deleteImage: 'Hapus',
  closeImage: 'Tutup',
  imageShareTitle: 'Gambar dari chat',
  imageShareText: 'Lihat gambar ini',
  messageDeleted: 'Pesan dihapus',
  deleteMessageError: 'Gagal menghapus pesan'
}
```

## Тестирование

### Тестовые данные
Создан скрипт `scripts/testImageMessage.js` для добавления тестовых данных:

```bash
node scripts/testImageMessage.js
```

Скрипт создает:
- Тестовую фиксацию клиента "Иван Петров"
- Чат фиксации с сообщениями
- Сообщение с изображением
- Обычное текстовое сообщение

### Проверка функциональности
1. Открыть веб-приложение
2. Перейти в раздел "Фиксации клиентов"
3. Найти фиксацию "Иван Петров"
4. Нажать "Чат с агентом"
5. Проверить отображение изображения
6. Нажать на изображение для полноэкранного просмотра
7. Проверить навигацию и функции

## Совместимость

### iOS приложение
Функциональность полностью совместима с форматом данных iOS приложения:
- Поддержка формата `thumbURL||fullURL`
- Обработка `mediaType: "image"`
- Совместимость с существующей структурой сообщений

### Браузеры
- Поддержка современных браузеров
- Адаптивный дизайн для мобильных устройств
- Поддержка touch-событий для мобильных устройств

## Безопасность

- Проверка прав доступа к изображениям
- Валидация URL изображений
- Обработка ошибок загрузки
- Безопасное удаление сообщений

## Производительность

- Ленивая загрузка изображений
- Кэширование миниатюр
- Оптимизация для больших изображений
- Индикаторы загрузки для лучшего UX 